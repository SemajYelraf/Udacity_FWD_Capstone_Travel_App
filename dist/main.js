/*! For license information please see main.js.LICENSE.txt */
var Client=function(e){var t={};function n(a){if(t[a])return t[a].exports;var o=t[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(a,o,function(t){return e[t]}.bind(null,o));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){"use strict";var a=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==a)return a;throw new Error("unable to locate global object")}();e.exports=t=a.fetch,t.default=a.fetch.bind(a),t.Headers=a.Headers,t.Request=a.Request,t.Response=a.Response},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";function a(e,t){this.moduleName=e,this.errorMsg=t}n.r(t),n.d(t,"getDestinationData",(function(){return y})),n.d(t,"getCityData",(function(){return f})),n.d(t,"getDaysTilDeparture",(function(){return p})),n.d(t,"getWeatherData",(function(){return o})),n.d(t,"postData",(function(){return h})),n.d(t,"mergeObjects",(function(){return r})),n.d(t,"saveTripData",(function(){return l})),n.d(t,"getTripData",(function(){return d})),n.d(t,"clearTripData",(function(){return g})),n.d(t,"deleteItinerary",(function(){return u})),n.d(t,"UserException",(function(){return a}));const o=async e=>{let t=`https://api.weatherbit.io/v2.0/forecast/daily?key=bbe3b278fd8c4242aacd8dc4e541820d&lang=en&units=I&days=1&city=${e.geonames[0].name}&country=${e.geonames[0].countryCode}`;const n=await fetch(t).catch(e=>{console.log("getWeatherData fetch() error: "+e)});try{const t=await n.json();return console.log("... weather.js : getWeatherData() :: weatherData =  "+JSON.stringify(t)),r(e,t)}catch(e){throw new a("weather","getWeatherData() ... "+e)}};function r(e,t){console.log("... mergeObjects() :: object1 = "+JSON.stringify(e)+" ... object2 = "+JSON.stringify(t));let n={...e,...t};return console.log("... mergeObjects() :: dataObj = "+JSON.stringify(n)),n}var i=n.p+"9875fd8b8ad4cfe1a31bc63f305bd9dc.jpg";const c=window.localStorage,s="trip"+c.length,l=()=>{const e={},t=document.querySelectorAll(".output");for(let n=0;n<t.length;n++)"image"==t[n].id?e[t[n].id]=t[n].src:e[t[n].id]=t[n].innerHTML;console.log(e),console.log("... key = "+s),c.setItem(JSON.stringify(s),JSON.stringify(e))},d=()=>{let e=c.getItem(JSON.stringify(s)),t=JSON.parse(e);document.getElementById("tripDate").innerHTML=t.tripDate,document.getElementById("city").innerHTML=t.city,document.getElementById("daysTilDepart").innerHTML=t.daysTilDepart,document.getElementById("city_lng").innerHTML=t.city_lng,document.getElementById("city_lat").innerHTML=t.city_lat,document.getElementById("image").src=t.image},g=()=>{console.log("tripHistory count before clear = "+c.length),c.clear(),console.log("tripHistory count after clear = "+c.length),u()},u=()=>{document.getElementById("city").innerHTML="",document.getElementById("city_lat").innerHTML="",document.getElementById("city_lng").innerHTML="",document.getElementById("country").innerHTML="",document.getElementById("daysTilDepart").innerHTML="",document.getElementById("tripDate").innerHTML="",document.getElementById("lo_temp").innerHTML="",document.getElementById("hi_temp").innerHTML="",document.getElementById("currForecast").innerHTML="",document.getElementById("forecast").innerHTML=""},m=n(0);function y(){console.log("... app.js : getDestinationData()");let e=document.getElementById("destination").value;if(""===e||/[0-9]|[!@#$%^&*()_\-+=:";\'<>?,./]/.test(e))return void(document.getElementById("cityErrMsg").innerHTML="Please enter a valid city ...");document.getElementById("cityErrMsg").innerHTML="",console.log("... getDestinationData() : destination = "+e);let t=document.getElementById("departureDate").value;if(""===t)return void(document.getElementById("dateErrMsg").innerHTML="Please enter a departure date ...");let n=new Intl.DateTimeFormat("en-US",{month:"2-digit",day:"2-digit",year:"numeric"}).format(new Date(t+"T00:00:00")),c=p(n);if(c<0)return void(document.getElementById("dateErrMsg").innerHTML="Please enter a future departure date ...");document.getElementById("dateErrMsg").innerHTML="",console.log("... getDestinationData() : departureDate = "+n),console.log("... getDestinationData() : numDays = "+c),u();f("http://api.geonames.org/searchJSON?username=jamespfarley&lang=en&maxRows=1&style=short&name_equals="+e,e).then(e=>o(e)).then(e=>(async e=>{console.log("... postPixabayCity : data.geonames[0].name = "+e.geonames[0].name);const t={};t.city=e.geonames[0].name;fetch("http://localhost:8081/pixabay",{method:"POST",credentials:"same-origin",headers:{"Content-type":"application/json"},body:JSON.stringify(t)}).catch(e=>{throw new a("pixabay","postPixabayCity() fetch() error: "+e)});return e})(e)).then(e=>(async e=>{console.log("... pixabay.js : getDestinationImage() :: data.geonames[0].name = "+JSON.stringify(e.geonames[0].name));const t=await fetch("http://localhost:8081/pixabay").catch(e=>{console.log("updateUI fetch() error: "+e)});try{const n={},a=await t.json();return console.log("...  pixabay.js : getDestinationImage() :: data = "+JSON.stringify(e)),console.log("...  pixabay.js : getDestinationImage() :: imgData.total = "+JSON.stringify(a.total)),a.total>0?n.imgUrl=a.hits[0].previewURL:n.imgUrl=i,console.log("...  pixabay.js : getDestinationImage() :: imgData = "+JSON.stringify(n)),r(e,n)}catch(e){throw new a("pixabay","getDestinationImage() ... "+e)}})(e)).then(e=>h("http://localhost:8081/destination",{latitude:e.geonames[0].lat,longitude:e.geonames[0].lng,city:e.geonames[0].name,country:e.geonames[0].countryCode,diffInDays:c,lo_temp:e.data[0].low_temp,hi_temp:e.data[0].high_temp,forecast:e.data[0].weather.description,image:e.imgUrl,tripDate:n})).then(()=>D()).catch(e=>{console.error("ERROR : getDestinationData() chained promises :: "+e.moduleName+" ... "+e.errorMsg)})}const p=e=>{const t=new Date;let n=new Date(e);return console.log(`Current date = ${t} ... departureDate = ${n}`),Math.trunc((n.getTime()-t.getTime())/864e5)},f=async(e,t)=>{console.log("... app.js : getCityData()");const n=await m(e).catch(e=>{console.log("getCityData fetch() error: "+e)});try{const e=await n.json();if(console.log("app.js : getCityData() :: cityData = "+JSON.stringify(e)),0==e.totalResultsCount)throw document.getElementById("city").innerHTML=`Sorry, there is no information available for ${t} ...`,new a("city","getCityData() ... No data available");return e}catch(e){throw new a("getCityData()",e)}},h=async(e,t)=>{console.log("... app.js : postData() :: data = "+JSON.stringify(t));const n=await m(e,{method:"POST",credentials:"same-origin",headers:{"Content-type":"application/json"},body:JSON.stringify(t)}).catch(e=>{console.log("postData() fetch() error: "+e)});try{const e=await n.json();return console.log("... app.js : postData() :: newData = "+JSON.stringify(e)),e}catch(e){console.error("Error in postData() : "+e)}},D=async()=>{console.log("... app.js : updateUI()");const e=await m("http://localhost:8081/all").catch(e=>{console.log("updateUI fetch() error: "+e)}),t=document.getElementById("image");try{const n=await e.json();console.log("... app.js : updateUI() :: data = "+JSON.stringify(n));let a="Your trip to "+n.city+", "+n.country;document.getElementById("city").innerHTML=a,document.getElementById("tripDate").innerHTML="on "+n.tripDate,document.getElementById("daysTilDepart").innerHTML="is in "+n.diffInDays+" days.",document.getElementById("city_lat").innerHTML="Latitude : "+n.latitude,document.getElementById("city_lng").innerHTML="Longitude : "+n.longitude,document.getElementById("currForecast").innerHTML="Current forecast : ",document.getElementById("forecast").innerHTML=n.forecast,document.getElementById("lo_temp").innerHTML="Lo : "+n.lo_temp,document.getElementById("hi_temp").innerHTML="Hi : "+n.hi_temp,t.setAttribute("src",n.image)}catch(e){throw new a("UI","updateUI() ... "+e)}};n(1),n(2),n(3),n(4);document.onreadystatechange=()=>{"interactive"==document.readyState&&(document.getElementById("search").addEventListener("click",y),document.getElementById("save").addEventListener("click",l),document.getElementById("delete").addEventListener("click",g),document.getElementById("image").setAttribute("src",i),localStorage.length>0&&d())}}]);